"use strict";(()=>{var e={};e.id=890,e.ids=[890,660],e.modules={664:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.r(a),s.d(a,{config:()=>j,default:()=>p,getServerSideProps:()=>h,getStaticPaths:()=>f,getStaticProps:()=>x,reportWebVitals:()=>g,routeModule:()=>S,unstable_getServerProps:()=>b,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>N,unstable_getStaticProps:()=>y});var r=s(7093),l=s(5244),i=s(1323),n=s(2899),o=s.n(n),d=s(6958),c=s.n(d),m=s(1209),u=e([m]);m=(u.then?(await u)():u)[0];let p=(0,i.l)(m,"default"),x=(0,i.l)(m,"getStaticProps"),f=(0,i.l)(m,"getStaticPaths"),h=(0,i.l)(m,"getServerSideProps"),j=(0,i.l)(m,"config"),g=(0,i.l)(m,"reportWebVitals"),y=(0,i.l)(m,"unstable_getStaticProps"),N=(0,i.l)(m,"unstable_getStaticPaths"),v=(0,i.l)(m,"unstable_getStaticParams"),b=(0,i.l)(m,"unstable_getServerProps"),w=(0,i.l)(m,"unstable_getServerSideProps"),S=new r.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/Subscriptions",pathname:"/Subscriptions",bundlePath:"",filename:""},components:{App:c(),Document:o()},userland:m});t()}catch(e){t(e)}})},9967:(e,a,s)=>{s.d(a,{Z:()=>t});let t=(0,s(1462).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9128:(e,a,s)=>{s.d(a,{Z:()=>t});let t=(0,s(1462).Z)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},3594:(e,a,s)=>{s.d(a,{Z:()=>t});let t=(0,s(1462).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},5197:(e,a,s)=>{s.d(a,{Z:()=>t});let t=(0,s(1462).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3023:(e,a,s)=>{s.d(a,{Z:()=>t});let t=(0,s(1462).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},9416:(e,a,s)=>{s.d(a,{Z:()=>r});var t=s(997);s(6689);let r=({title:e,description:a,icon:s,actions:r})=>(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[s&&t.jsx("div",{className:"text-primary",children:s}),(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:e}),a&&t.jsx("p",{className:"text-muted-foreground mt-1",children:a})]})]}),r&&t.jsx("div",{className:"flex items-center gap-2",children:r})]})},4416:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.d(a,{Z:()=>j});var r=s(997),l=s(6689),i=s(6317),n=s(435),o=s(8898),d=s(2417),c=s(1519),m=s(428),u=s(5197),p=s(9967),x=s(2378),f=s(4661),h=e([o,d,c,m,x]);[o,d,c,m,x]=h.then?(await h)():h;let j=()=>{let{user:e}=(0,i.a)(),a=(0,f.useNavigate)(),{planos:s,loading:t,subscreverPlano:h,iniciarTrial:j,assinaturaAtual:g}=(0,n.m)(),[y,N]=(0,l.useState)("mensal"),[v,b]=(0,l.useState)(null),[w,S]=(0,l.useState)(!1),[_,Z]=(0,l.useState)(!1),k=s=>{if(!e){a("/auth");return}b(s),S(!0)},P=async()=>{v&&e&&(Z(!0),await j(v),Z(!1),S(!1))},C=async()=>{v&&e&&(Z(!0),await h(v,y),Z(!1),S(!1))},R=e=>new Intl.NumberFormat("pt-PT",{style:"currency",currency:"EUR",minimumFractionDigits:0}).format(e);return t?r.jsx("div",{className:"flex justify-center items-center py-12",children:r.jsx(u.Z,{className:"h-8 w-8 animate-spin text-primary"})}):(0,r.jsxs)("div",{children:[r.jsx("div",{className:"flex justify-center mb-8",children:(0,r.jsxs)(c.E,{value:y,onValueChange:e=>N(e),className:"flex items-center space-x-2 bg-muted p-1 rounded-lg",children:[(0,r.jsxs)("div",{className:`flex items-center space-x-2 rounded-md px-3 py-2 ${"mensal"===y?"bg-background shadow-sm":""}`,children:[r.jsx(c.m,{value:"mensal",id:"mensal",className:"sr-only"}),r.jsx(m._,{htmlFor:"mensal",className:`cursor-pointer ${"mensal"===y?"font-medium":""}`,children:"Mensal"})]}),(0,r.jsxs)("div",{className:`flex items-center space-x-2 rounded-md px-3 py-2 ${"anual"===y?"bg-background shadow-sm":""}`,children:[r.jsx(c.m,{value:"anual",id:"anual",className:"sr-only"}),(0,r.jsxs)(m._,{htmlFor:"anual",className:`cursor-pointer ${"anual"===y?"font-medium":""}`,children:["Anual ",r.jsx("span",{className:"text-xs text-green-600 font-semibold ml-1",children:"-17%"})]})]})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:s.map(e=>{let a="Solo"===e.nome,s="mensal"===y?e.preco_mensal:Math.round(e.preco_anual/12),t=R(s),l=g?.plano_id===e.id,i=e.recursos.map(e=>({name:e,included:!0}));return r.jsx(o.Z,{title:e.nome,price:t,period:"mensal"===y?"/m\xeas":"/m\xeas, faturado anualmente",description:e.descricao||"",features:i,buttonText:l?"Plano Atual":"Selecionar Plano",buttonVariant:l?"outline":"default",popular:a,onClick:()=>!l&&k(e.id),disabled:l},e.id)})}),r.jsx(x.Vq,{open:w,onOpenChange:S,children:(0,r.jsxs)(x.cZ,{className:"sm:max-w-md",children:[(0,r.jsxs)(x.fK,{children:[r.jsx(x.$N,{children:"Confirmar Subscri\xe7\xe3o"}),r.jsx(x.Be,{children:"Escolha como deseja prosseguir com a subscri\xe7\xe3o do plano selecionado."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[!g&&(0,r.jsxs)(d.z,{onClick:P,variant:"outline",className:"w-full justify-start text-left",disabled:_,children:[_?r.jsx(u.Z,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"Come\xe7ar com 15 dias gr\xe1tis"]}),(0,r.jsxs)(d.z,{onClick:C,className:"w-full justify-start text-left",disabled:_,children:[_?r.jsx(u.Z,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"Subscrever agora"]})]}),r.jsx(x.cN,{className:"sm:justify-start",children:r.jsx(d.z,{variant:"secondary",onClick:()=>S(!1),disabled:_,children:"Cancelar"})})]})})]})};t()}catch(e){t(e)}})},5530:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.d(a,{Z:()=>g});var r=s(997),l=s(6689),i=s.n(l),n=s(435),o=s(1064),d=s(2417),c=s(5181),m=s(5197),u=s(3023),p=s(9967),x=s(546),f=s(6014),h=s(4711),j=e([o,d,c,x,h]);[o,d,c,x,h]=j.then?(await j)():j;let g=()=>{let{assinaturaAtual:e,cancelarAssinatura:a,loading:s}=(0,n.m)(),[t,l]=i().useState(!1),j=async()=>{l(!0),await a(),l(!1)};if(s)return r.jsx("div",{className:"flex justify-center items-center py-12",children:r.jsx(m.Z,{className:"h-8 w-8 animate-spin text-primary"})});if(!e)return(0,r.jsxs)(o.Zb,{className:"w-full border-2 shadow-md",children:[(0,r.jsxs)(o.Ol,{children:[r.jsx(o.ll,{className:"text-xl md:text-2xl",children:"Sem Subscri\xe7\xe3o Ativa"}),r.jsx(o.SZ,{children:"Atualmente n\xe3o tem nenhuma subscri\xe7\xe3o ativa no sistema."})]}),r.jsx(o.aY,{children:(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-amber-600 p-4 bg-amber-50 rounded-md",children:[r.jsx(u.Z,{size:20}),r.jsx("p",{children:"Subscreva um plano para aceder a todas as funcionalidades."})]})}),r.jsx(o.eW,{children:r.jsx(d.z,{variant:"default",className:"w-full md:w-auto",onClick:()=>window.scrollTo({top:document.getElementById("planos")?.offsetTop,behavior:"smooth"}),children:"Ver Planos Dispon\xedveis"})})]});let g=e=>e?(0,f.WU)(new Date(e),"dd/MM/yyyy",{locale:h.pt}):"N/A",y=e.plano,N="trial"===e.estado,v=g(e.data_fim),b=g(e.data_inicio);return(0,r.jsxs)(o.Zb,{className:"w-full border-2 shadow-md",children:[r.jsx(o.Ol,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.ll,{className:"text-xl md:text-2xl flex flex-wrap items-center gap-2",children:[r.jsx("span",{children:y?.nome||"Plano Ativo"}),N&&r.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded",children:"Per\xedodo de Teste"})]}),r.jsx(o.SZ,{className:"mt-1",children:y?.descricao||"Informa\xe7\xf5es sobre o seu plano atual"})]}),(0,r.jsxs)("div",{className:"text-xl font-bold text-primary",children:[y?.preco_mensal?`${y.preco_mensal}â‚¬`:"",r.jsx("span",{className:"text-sm text-muted-foreground font-normal",children:"/m\xeas"})]})]})}),(0,r.jsxs)(o.aY,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Estado da Subscri\xe7\xe3o"}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(p.Z,{className:"text-green-500 mr-2 h-5 w-5"}),r.jsx("span",{className:"font-medium capitalize",children:e.estado})]})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Fatura\xe7\xe3o"}),r.jsx("p",{className:"font-medium capitalize",children:e.periodo_faturacao})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Data de In\xedcio"}),r.jsx("p",{className:"font-medium",children:b})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Data de Expira\xe7\xe3o"}),r.jsx("p",{className:"font-medium",children:v})]})]})]}),"number"==typeof e.percentualRestante&&(0,r.jsxs)("div",{className:"mt-6 space-y-3 p-4 bg-slate-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"font-medium",children:"Tempo Restante"}),(0,r.jsxs)("span",{className:"font-bold",children:[e.diasRestantes," dias"]})]}),r.jsx(c.E,{value:e.percentualRestante,className:"h-2"})]}),y?.recursos&&y.recursos.length>0&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-slate-50 rounded-lg",children:[r.jsx("p",{className:"text-sm font-medium mb-3",children:"Recursos Inclu\xeddos"}),r.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:y.recursos.map((e,a)=>(0,r.jsxs)("li",{className:"flex items-start",children:[r.jsx(p.Z,{className:"text-green-500 mr-2 h-4 w-4 mt-0.5 flex-shrink-0"}),r.jsx("span",{className:"text-sm",children:e})]},a))})]})]}),r.jsx(o.eW,{className:"flex justify-end pt-4",children:(0,r.jsxs)(x.aR,{children:[r.jsx(x.vW,{asChild:!0,children:r.jsx(d.z,{variant:"destructive",children:"Cancelar Subscri\xe7\xe3o"})}),(0,r.jsxs)(x._T,{children:[(0,r.jsxs)(x.fY,{children:[r.jsx(x.f$,{children:"Tem a certeza?"}),r.jsx(x.yT,{children:"Esta a\xe7\xe3o ir\xe1 cancelar a sua subscri\xe7\xe3o atual. Poder\xe1 continuar a utilizar o servi\xe7o at\xe9 ao final do per\xedodo j\xe1 pago."})]}),(0,r.jsxs)(x.xo,{children:[r.jsx(x.le,{children:"Cancelar"}),r.jsx(x.OL,{onClick:j,disabled:t,children:t?(0,r.jsxs)(r.Fragment,{children:[r.jsx(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"A processar..."]}):"Sim, quero cancelar"})]})]})]})})]})};t()}catch(e){t(e)}})},546:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.d(a,{OL:()=>y,_T:()=>x,aR:()=>c,f$:()=>j,fY:()=>f,le:()=>N,vW:()=>m,xo:()=>h,yT:()=>g});var r=s(997),l=s(6689),i=s(2131),n=s(3917),o=s(2417),d=e([i,n,o]);[i,n,o]=d.then?(await d)():d;let c=i.Root,m=i.Trigger,u=i.Portal,p=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Overlay,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:s}));p.displayName=i.Overlay.displayName;let x=l.forwardRef(({className:e,...a},s)=>(0,r.jsxs)(u,{children:[r.jsx(p,{}),r.jsx(i.Content,{ref:s,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a})]}));x.displayName=i.Content.displayName;let f=({className:e,...a})=>r.jsx("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...a});f.displayName="AlertDialogHeader";let h=({className:e,...a})=>r.jsx("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});h.displayName="AlertDialogFooter";let j=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Title,{ref:s,className:(0,n.cn)("text-lg font-semibold",e),...a}));j.displayName=i.Title.displayName;let g=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Description,{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",e),...a}));g.displayName=i.Description.displayName;let y=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Action,{ref:s,className:(0,n.cn)((0,o.d)(),e),...a}));y.displayName=i.Action.displayName;let N=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Cancel,{ref:s,className:(0,n.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",e),...a}));N.displayName=i.Cancel.displayName,t()}catch(e){t(e)}})},2378:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.d(a,{$N:()=>h,Be:()=>j,Vq:()=>c,cN:()=>f,cZ:()=>p,fK:()=>x});var r=s(997),l=s(6689),i=s(7715),n=s(8154),o=s(3917),d=e([i,o]);[i,o]=d.then?(await d)():d;let c=i.Root;i.Trigger;let m=i.Portal;i.Close;let u=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Overlay,{ref:s,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));u.displayName=i.Overlay.displayName;let p=l.forwardRef(({className:e,children:a,...s},t)=>(0,r.jsxs)(m,{children:[r.jsx(u,{}),(0,r.jsxs)(i.Content,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[a,(0,r.jsxs)(i.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(n.Z,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));p.displayName=i.Content.displayName;let x=({className:e,...a})=>r.jsx("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});x.displayName="DialogHeader";let f=({className:e,...a})=>r.jsx("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});f.displayName="DialogFooter";let h=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Title,{ref:s,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",e),...a}));h.displayName=i.Title.displayName;let j=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Description,{ref:s,className:(0,o.cn)("text-sm text-muted-foreground",e),...a}));j.displayName=i.Description.displayName,t()}catch(e){t(e)}})},428:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.d(a,{_:()=>m});var r=s(997),l=s(6689),i=s(49),n=s(6926),o=s(3917),d=e([i,n,o]);[i,n,o]=d.then?(await d)():d;let c=(0,n.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),m=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Root,{ref:s,className:(0,o.cn)(c(),e),...a}));m.displayName=i.Root.displayName,t()}catch(e){t(e)}})},5181:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.d(a,{E:()=>d});var r=s(997),l=s(6689),i=s(6005),n=s(3917),o=e([i,n]);[i,n]=o.then?(await o)():o;let d=l.forwardRef(({className:e,value:a,...s},t)=>r.jsx(i.Root,{ref:t,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:r.jsx(i.Indicator,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));d.displayName=i.Root.displayName,t()}catch(e){t(e)}})},1519:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.d(a,{E:()=>c,m:()=>m});var r=s(997),l=s(6689),i=s(4086),n=s(9128),o=s(3917),d=e([i,o]);[i,o]=d.then?(await d)():d;let c=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Root,{className:(0,o.cn)("grid gap-2",e),...a,ref:s}));c.displayName=i.Root.displayName;let m=l.forwardRef(({className:e,...a},s)=>r.jsx(i.Item,{ref:s,className:(0,o.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...a,children:r.jsx(i.Indicator,{className:"flex items-center justify-center",children:r.jsx(n.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})}));m.displayName=i.Item.displayName,t()}catch(e){t(e)}})},435:(e,a,s)=>{s.d(a,{m:()=>n});var t=s(6689),r=s(6317),l=s(585),i=s(8553);let n=()=>{let{user:e}=(0,r.a)(),[a,s]=(0,t.useState)(!0),[n,o]=(0,t.useState)(null),[d,c]=(0,t.useState)([]),[m,u]=(0,t.useState)(null),p=async()=>{try{s(!0);let{data:e,error:a}=await l.O.from("planos").select("*").eq("ativo",!0).order("preco_mensal",{ascending:!0});if(a)throw console.error("Erro ao buscar planos:",a),a;e?c(e):c([])}catch(e){console.error("Erro ao buscar planos:",e),o(e)}finally{s(!1)}},x=async()=>{if(e)try{s(!0);let{data:a,error:t}=await l.O.from("assinaturas").select(`
          *,
          plano:planos(*)
        `).eq("user_id",e.id).in("estado",["ativa","trial"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(t)throw console.error("Erro ao buscar assinatura:",t),t;if(a){let e,s,t;if(a.data_fim){let t=new Date,r=new Date(a.data_fim),l=new Date(a.data_inicio),i=r.getTime()-t.getTime();e=Math.ceil(i/864e5);let n=r.getTime()-l.getTime(),o=t.getTime()-l.getTime();s=100-Math.min(100,Math.max(0,o/n*100))}let r="anual"===a.periodo_faturacao?"anual":"mensal";switch(a.estado){case"ativa":t="ativa";break;case"trial":t="trial";break;case"pendente":default:t="pendente";break;case"cancelada":t="cancelada";break;case"expirada":t="expirada"}let l={...a,diasRestantes:e,percentualRestante:s,periodo_faturacao:r,estado:t,plano:a.plano};u(l)}else u(null)}catch(e){console.error("Erro ao buscar assinatura:",e),o(e)}finally{s(!1)}},f=async(a,t="mensal")=>{if(!e||!a){(0,i.Am)({title:"Erro",description:"Dados inv\xe1lidos",variant:"destructive"});return}try{s(!0);let{data:r}=await l.O.from("assinaturas").select("*").eq("user_id",e.id).in("estado",["ativa","trial"]);r&&r.length>0&&await l.O.from("assinaturas").update({estado:"cancelada"}).in("id",r.map(e=>e.id));let n=new Date,o=new Date(n);"mensal"===t?o.setMonth(o.getMonth()+1):o.setFullYear(o.getFullYear()+1);let{data:d,error:c}=await l.O.from("assinaturas").insert({user_id:e.id,plano_id:a,periodo_faturacao:t,data_inicio:n.toISOString(),data_fim:o.toISOString(),estado:"ativa",trial:!1}).select().single();if(c)throw c;return(0,i.Am)({title:"Sucesso",description:"Plano subscrito com sucesso"}),u(d),d}catch(e){return console.error("Erro ao subscrever plano:",e),(0,i.Am)({title:"Erro",description:"Ocorreu um erro ao subscrever o plano",variant:"destructive"}),null}finally{s(!1)}},h=async()=>{if(!e||!m){(0,i.Am)({title:"Erro",description:"N\xe3o h\xe1 assinatura ativa para cancelar",variant:"destructive"});return}try{s(!0);let{error:e}=await l.O.from("assinaturas").update({estado:"cancelada"}).eq("id",m.id);if(e)throw e;(0,i.Am)({title:"Sucesso",description:"Assinatura cancelada com sucesso"}),u(null)}catch(e){console.error("Erro ao cancelar assinatura:",e),(0,i.Am)({title:"Erro",description:"Ocorreu um erro ao cancelar a assinatura",variant:"destructive"})}finally{s(!1)}},j=async a=>{if(!e||!a){(0,i.Am)({title:"Erro",description:"Dados inv\xe1lidos",variant:"destructive"});return}try{s(!0);let{data:t}=await l.O.from("assinaturas").select("*").eq("user_id",e.id).eq("trial",!0).single();if(t){(0,i.Am)({title:"Aviso",description:"Voc\xea j\xe1 utilizou o per\xedodo de teste",variant:"destructive"});return}let{data:r}=await l.O.from("assinaturas").select("*").eq("user_id",e.id).in("estado",["ativa","trial"]);r&&r.length>0&&await l.O.from("assinaturas").update({estado:"cancelada"}).in("id",r.map(e=>e.id));let n=new Date,o=new Date(n);o.setDate(o.getDate()+15);let{data:d,error:c}=await l.O.from("assinaturas").insert({user_id:e.id,plano_id:a,periodo_faturacao:"mensal",data_inicio:n.toISOString(),data_fim:o.toISOString(),estado:"trial",trial:!0}).select().single();if(c)throw c;return(0,i.Am)({title:"Sucesso",description:"Per\xedodo de teste iniciado com sucesso"}),u(d),d}catch(e){return console.error("Erro ao iniciar trial:",e),(0,i.Am)({title:"Erro",description:"Ocorreu um erro ao iniciar o per\xedodo de teste",variant:"destructive"}),null}finally{s(!1)}};return(0,t.useEffect)(()=>{p()},[]),(0,t.useEffect)(()=>{e?x():u(null)},[e]),{loading:a,error:n,planos:d,assinaturaAtual:m,fetchPlanos:p,fetchAssinaturaAtual:x,subscreverPlano:f,cancelarAssinatura:h,iniciarTrial:j}}},1209:(e,a,s)=>{s.a(e,async(e,t)=>{try{s.r(a),s.d(a,{default:()=>f});var r=s(997),l=s(6689),i=s.n(l),n=s(6317),o=s(4416),d=s(5530),c=s(5278),m=s(4661),u=s(3594),p=s(9416),x=e([o,d,c]);[o,d,c]=x.then?(await x)():x;let f=()=>{let{user:e,userRole:a}=(0,n.a)(),s=(0,m.useNavigate)(),[t,l]=i().useState(e?"minha-assinatura":"planos");return i().useEffect(()=>{e||s("/auth")},[e,s]),r.jsx("div",{className:"min-h-screen bg-background pt-16 animate-fade-in",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[r.jsx(p.Z,{title:"Subscri\xe7\xf5es",description:"Gerencie a sua subscri\xe7\xe3o e veja os planos dispon\xedveis",icon:r.jsx(u.Z,{size:28})}),(0,r.jsxs)(c.mQ,{defaultValue:t,value:t,onValueChange:l,className:"w-full mb-8",children:[(0,r.jsxs)(c.dr,{className:"w-full md:w-auto mb-4",children:[e&&r.jsx(c.SP,{value:"minha-assinatura",children:"Minha Subscri\xe7\xe3o"}),r.jsx(c.SP,{value:"planos",id:"planos",children:"Planos Dispon\xedveis"})]}),e&&r.jsx(c.nU,{value:"minha-assinatura",className:"pt-4",children:r.jsx("div",{className:"max-w-3xl mx-auto",children:r.jsx(d.Z,{})})}),r.jsx(c.nU,{value:"planos",className:"pt-4",children:r.jsx(o.Z,{})})]})]})})};t()}catch(e){t(e)}})},2885:e=>{e.exports=require("@supabase/supabase-js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},4661:e=>{e.exports=require("react-router-dom")},997:e=>{e.exports=require("react/jsx-runtime")},5315:e=>{e.exports=require("path")},2131:e=>{e.exports=import("@radix-ui/react-alert-dialog")},7715:e=>{e.exports=import("@radix-ui/react-dialog")},49:e=>{e.exports=import("@radix-ui/react-label")},6005:e=>{e.exports=import("@radix-ui/react-progress")},4086:e=>{e.exports=import("@radix-ui/react-radio-group")},4338:e=>{e.exports=import("@radix-ui/react-slot")},6860:e=>{e.exports=import("@radix-ui/react-tabs")},6926:e=>{e.exports=import("class-variance-authority")},6593:e=>{e.exports=import("clsx")},4711:e=>{e.exports=import("date-fns/locale")},8097:e=>{e.exports=import("tailwind-merge")}};var a=require("../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),t=a.X(0,[899,893,730],()=>s(664));module.exports=t})();